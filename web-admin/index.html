<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run With Kam - Admin Panel</title>
    <link rel="stylesheet" href="styles.css?v=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Fallback styles in case CSS doesn't load */
        .screen { display: none; }
        .screen.active { display: block; }
        .hidden { display: none; }
        .login-container { 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }
        .login-form { 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); 
            width: 100%; 
            max-width: 400px; 
            color: #333;
        }
        .btn { 
            padding: 15px 30px; 
            border: none; 
            border-radius: 12px; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            margin: 5px;
        }
        .btn-primary { background: #ff6b6b; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .input-group { margin-bottom: 20px; }
        .input-group input { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid #e9ecef; 
            border-radius: 12px; 
            font-size: 1rem; 
        }
        
        .welcome-header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            margin-bottom: 20px;
        }
        
        .welcome-header .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .welcome-header .logo i {
            font-size: 3rem;
            color: white;
        }
        
        .welcome-header .logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
        }
        
        .welcome-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Welcome Header -->
    <div class="welcome-header">
        <div class="logo">
            <i class="fas fa-running"></i>
            <h1>Run With Kam</h1>
        </div>
        <p>Admin Panel - Direct Access</p>
    </div>

    <!-- Main Admin Dashboard -->
    <div id="dashboardScreen">
        <header class="dashboard-header">
            <div class="header-left">
                <h1><i class="fas fa-running"></i> Run With Kam Admin</h1>
            </div>
            <div class="header-right">
                <button id="addRunBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Add Run
                </button>
                <button id="refreshBtn" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
                <button id="debugBtn" class="btn btn-secondary">
                    <i class="fas fa-bug"></i>
                    Debug
                </button>
                <button id="logoutBtn" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </header>

        <main class="dashboard-main">
            <!-- Calendar Navigation -->
            <div class="calendar-nav">
                <button id="prevMonth" class="btn btn-icon">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h2 id="currentMonth">August 2025</h2>
                <button id="nextMonth" class="btn btn-icon">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar-grid">
                <div class="calendar-header">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div id="calendarDays" class="calendar-days"></div>
            </div>

            <!-- Runs List -->
            <div class="runs-section">
                <h3>Runs on <span id="selectedDate">August 18, 2025</span></h3>
                <div id="runsList" class="runs-list"></div>
            </div>

            <!-- Notifications Section -->
            <div class="notifications-section">
                <h3>üîî Recent Notifications</h3>
                <div id="notificationsContainer" class="notifications-list"></div>
            </div>
            
            <!-- Leaderboard Section -->
            <div class="leaderboard-section">
                <h3>üèÜ Leaderboard Management</h3>
                <div class="leaderboard-controls">
                    <button id="addUserBtn" class="btn btn-primary">Add New User</button>
                    <button id="refreshLeaderboardBtn" class="btn btn-secondary">Refresh</button>
                </div>
                <div id="leaderboardContainer" class="leaderboard-list">
                    <!-- Leaderboard will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Run Modal -->
    <div id="runModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Run</h3>
                <button id="closeModal" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="runForm" class="run-form" onsubmit="handleRunSubmit(event)">
                <div class="form-row">
                    <div class="input-group">
                        <label for="runDate">Date</label>
                        <input type="text" id="runDate" name="runDate" placeholder="YYYY-MM-DD" pattern="\d{4}-\d{2}-\d{2}" required>
                        <small class="form-help">Enter date in YYYY-MM-DD format (e.g., 2025-08-25)</small>
                    </div>
                    
                    <div class="input-group">
                        <label for="runTime">Time</label>
                        <input type="text" id="runTime" name="runTime" placeholder="HH:MM" pattern="\d{2}:\d{2}" required>
                        <small class="form-help">Enter time in 24-hour format (e.g., 06:00, 17:30)</small>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="runLocation">Location</label>
                    <input type="text" id="runLocation" name="runLocation" placeholder="e.g., Central Park" required>
                </div>
                
                <div class="input-group">
                    <label for="runPace">Pace</label>
                    <select id="runPace" name="runPace" required>
                        <option value="">Select pace</option>
                        <option value="6:00/mile">6:00/mile (Very Fast)</option>
                        <option value="6:30/mile">6:30/mile (Fast)</option>
                        <option value="7:00/mile">7:00/mile (Fast)</option>
                        <option value="7:30/mile">7:30/mile (Moderate-Fast)</option>
                        <option value="8:00/mile">8:00/mile (Moderate)</option>
                        <option value="8:30/mile">8:30/mile (Moderate)</option>
                        <option value="9:00/mile">9:00/mile (Moderate-Slow)</option>
                        <option value="9:30/mile">9:30/mile (Slow)</option>
                        <option value="10:00/mile">10:00/mile (Slow)</option>
                        <option value="10:30/mile">10:30/mile (Very Slow)</option>
                        <option value="11:00/mile">11:00/mile (Very Slow)</option>
                        <option value="12:00/mile">12:00/mile (Walking)</option>
                    </select>
                    <small class="form-help">Select your target pace per mile</small>
                </div>
                
                <div class="input-group">
                    <label for="runDescription">Description</label>
                    <textarea id="runDescription" name="runDescription" placeholder="Optional details about the run"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="cancelRun" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Run
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Run</h3>
                <button id="closeDeleteModal" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p>Are you sure you want to delete this run?</p>
                <p class="run-details" id="deleteRunDetails"></p>
            </div>
            
            <div class="form-actions">
                <button type="button" id="cancelDelete" class="btn btn-secondary">Cancel</button>
                <button type="button" id="confirmDelete" class="btn btn-danger">
                    <i class="fas fa-trash"></i>
                    Delete
                </button>
            </div>
        </div>
    </div>
    
    <!-- Leaderboard User Modal -->
    <div id="leaderboardModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="leaderboardModalTitle">Add New User</h3>
                <button id="closeLeaderboardModal" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="leaderboardForm" class="leaderboard-form" onsubmit="handleLeaderboardSubmit(event)">
                <div class="form-row">
                    <div class="input-group">
                        <label for="userFirstName">First Name</label>
                        <input type="text" id="userFirstName" name="userFirstName" placeholder="e.g., John" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="userLastName">Last Name</label>
                        <input type="text" id="userLastName" name="userLastName" placeholder="e.g., Smith" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label for="userTotalRuns">Total Runs</label>
                        <input type="number" id="userTotalRuns" name="userTotalRuns" placeholder="0" min="0" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="userTotalMiles">Total Miles</label>
                        <input type="number" id="userTotalMiles" name="userTotalMiles" placeholder="0.0" min="0" step="0.1" required>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="cancelLeaderboard" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save User
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Direct access admin panel
        console.log('üöÄ Admin panel loaded - direct access enabled!');
        
        // Test function
        window.testLogin = function() {
            console.log('üß™ Test function called!');
            alert('JavaScript is working!');
        };
        
        // Load data automatically when page loads
        window.addEventListener('load', function() {
            console.log('üìä Page loaded, loading data automatically...');
            loadBasicData();
            setupEventListeners();
        });
        
        // Setup all button event listeners
        function setupEventListeners() {
            console.log('üîó Setting up event listeners...');
            
            // Add Run Button
            const addRunBtn = document.getElementById('addRunBtn');
            if (addRunBtn) {
                addRunBtn.addEventListener('click', showAddRunModal);
                console.log('‚úÖ Add Run button listener added');
            }
            
            // Refresh Button
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshData);
                console.log('‚úÖ Refresh button listener added');
            }
            
            // Debug Button
            const debugBtn = document.getElementById('debugBtn');
            if (debugBtn) {
                debugBtn.addEventListener('click', debugDateConversion);
                console.log('‚úÖ Debug button listener added');
            }
            
            // Logout Button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
                console.log('‚úÖ Logout button listener added');
            }
            
            // Calendar Navigation
            const prevMonthBtn = document.getElementById('prevMonth');
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', () => navigateMonth(-1));
                console.log('‚úÖ Previous Month button listener added');
            }
            
            const nextMonthBtn = document.getElementById('nextMonth');
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', () => navigateMonth(1));
                console.log('‚úÖ Next Month button listener added');
            }
            
            // Add User Button
            const addUserBtn = document.getElementById('addUserBtn');
            if (addUserBtn) {
                addUserBtn.addEventListener('click', showAddUserModal);
                console.log('‚úÖ Add User button listener added');
            }
            
            // Refresh Leaderboard Button
            const refreshLeaderboardBtn = document.getElementById('refreshLeaderboardBtn');
            if (refreshLeaderboardBtn) {
                refreshLeaderboardBtn.addEventListener('click', refreshData);
                console.log('‚úÖ Refresh Leaderboard button listener added');
            }
            
            // Modal Close Buttons
            const closeModalBtn = document.getElementById('closeModal');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', hideRunModal);
                console.log('‚úÖ Close Run Modal button listener added');
            }
            
            const closeLeaderboardModalBtn = document.getElementById('closeLeaderboardModal');
            if (closeLeaderboardModalBtn) {
                closeLeaderboardModalBtn.addEventListener('click', hideLeaderboardModal);
                console.log('‚úÖ Close Leaderboard Modal button listener added');
            }
            
            // Cancel Buttons
            const cancelRunBtn = document.getElementById('cancelRun');
            if (cancelRunBtn) {
                cancelRunBtn.addEventListener('click', hideRunModal);
                console.log('‚úÖ Cancel Run button listener added');
            }
            
            const cancelLeaderboardBtn = document.getElementById('cancelLeaderboard');
            if (cancelLeaderboardBtn) {
                cancelLeaderboardBtn.addEventListener('click', hideLeaderboardModal);
                console.log('‚úÖ Cancel Leaderboard button listener added');
            }
            
            console.log('üéØ All event listeners setup complete!');
        }
        
        // Load basic data
        function loadBasicData() {
            console.log('üìä Loading basic data...');
            
            // Load runs
            fetch('http://localhost:3000/api/runs')
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Runs loaded:', data);
                    if (data.success) {
                        displayRuns(data.data);
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading runs:', error);
                });
            
            // Load leaderboard
            fetch('http://localhost:3000/api/leaderboard')
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Leaderboard loaded:', data);
                    if (data.success) {
                        displayLeaderboard(data.data);
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading leaderboard:', error);
                });
        }
        
        // Display runs
        function displayRuns(runs) {
            const runsList = document.getElementById('runsList');
            if (runsList && runs.length > 0) {
                runsList.innerHTML = runs.map(run => `
                    <div style="border: 1px solid #ccc; padding: 10px; margin: 5px; border-radius: 5px;">
                        <strong>${run.location}</strong> - ${run.time}<br>
                        Date: ${new Date(run.date).toLocaleDateString()}<br>
                        Pace: ${run.pace}
                    </div>
                `).join('');
            }
        }
        
        // Display leaderboard
        function displayLeaderboard(users) {
            const leaderboardContainer = document.getElementById('leaderboardContainer');
            if (leaderboardContainer && users.length > 0) {
                leaderboardContainer.innerHTML = users.map(user => `
                    <div style="border: 1px solid #ccc; padding: 10px; margin: 5px; border-radius: 5px;">
                        <strong>${user.firstName} ${user.lastName}</strong><br>
                        Runs: ${user.totalRuns} | Miles: ${user.totalMiles}
                    </div>
                `);
            }
        }
        
        // Add Run Modal Functions
        window.showAddRunModal = function() {
            console.log('‚ûï Opening Add Run Modal');
            document.getElementById('runModal').classList.remove('hidden');
            document.getElementById('modalTitle').textContent = 'Add New Run';
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('runDate').value = today;
            document.getElementById('runTime').value = '08:00';
        };
        
        window.hideRunModal = function() {
            console.log('‚ùå Closing Run Modal');
            document.getElementById('runModal').classList.add('hidden');
            document.getElementById('runForm').reset();
        };
        
        // Handle Run Form Submit
        window.handleRunSubmit = function(event) {
            event.preventDefault();
            console.log('üíæ Submitting run form...');
            
            const formData = new FormData(event.target);
            const runData = {
                date: formData.get('runDate'),
                time: formData.get('runTime'),
                location: formData.get('runLocation'),
                pace: formData.get('runPace'),
                description: formData.get('runDescription')
            };
            
            console.log('üìù Run data:', runData);
            
            // Send to API
            fetch('http://localhost:3000/api/runs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(runData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('‚úÖ Run added successfully!');
                    hideRunModal();
                    loadBasicData(); // Reload data
                    alert('Run added successfully!');
                } else {
                    console.error('‚ùå Failed to add run:', data.message);
                    alert('Failed to add run: ' + data.message);
                }
            })
            .catch(error => {
                console.error('‚ùå Error adding run:', error);
                alert('Error adding run: ' + error.message);
            });
        };
        
        // Calendar Navigation
        window.navigateMonth = function(direction) {
            console.log('üìÖ Navigating month:', direction);
            const currentMonthElement = document.getElementById('currentMonth');
            if (currentMonthElement) {
                const currentText = currentMonthElement.textContent;
                const [month, year] = currentText.split(' ');
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                let monthIndex = monthNames.indexOf(month);
                let yearNum = parseInt(year);
                
                monthIndex += direction;
                if (monthIndex < 0) {
                    monthIndex = 11;
                    yearNum--;
                } else if (monthIndex > 11) {
                    monthIndex = 0;
                    yearNum++;
                }
                
                currentMonthElement.textContent = `${monthNames[monthIndex]} ${yearNum}`;
                console.log('‚úÖ Month updated to:', currentMonthElement.textContent);
            }
        };
        
        // Refresh Functions
        window.refreshData = function() {
            console.log('üîÑ Refreshing all data...');
            loadBasicData();
            alert('Data refreshed!');
        };
        
        // Logout Function (just reloads the page)
        window.handleLogout = function() {
            console.log('üö™ Logging out...');
            if (confirm('Are you sure you want to logout?')) {
                location.reload();
            }
        };
        
        // Leaderboard Functions
        window.showAddUserModal = function() {
            console.log('üë§ Opening Add User Modal');
            document.getElementById('leaderboardModal').classList.remove('hidden');
            document.getElementById('leaderboardModalTitle').textContent = 'Add New User';
            document.getElementById('leaderboardForm').reset();
        };
        
        window.hideLeaderboardModal = function() {
            console.log('‚ùå Closing Leaderboard Modal');
            document.getElementById('leaderboardModal').classList.add('hidden');
            document.getElementById('leaderboardForm').reset();
        };
        
        // Handle Leaderboard Form Submit
        window.handleLeaderboardSubmit = function(event) {
            event.preventDefault();
            console.log('üíæ Submitting leaderboard form...');
            
            const formData = new FormData(event.target);
            const userData = {
                firstName: formData.get('userFirstName'),
                lastName: formData.get('userLastName'),
                totalRuns: parseInt(formData.get('userTotalRuns')),
                totalMiles: parseFloat(formData.get('userTotalMiles'))
            };
            
            console.log('üë§ User data:', userData);
            
            // Send to API
            fetch('http://localhost:3000/api/leaderboard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('‚úÖ User added successfully!');
                    hideLeaderboardModal();
                    loadBasicData(); // Reload data
                    alert('User added successfully!');
                } else {
                    console.error('‚ùå Failed to add user:', data.message);
                    alert('Failed to add user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('‚ùå Error adding user:', error);
                alert('Error adding user: ' + error.message);
            });
        };
        
        // Debug Function
        window.debugDateConversion = function() {
            console.log('üêõ Debug: Testing date conversion...');
            const testDate = '2025-09-24';
            const [year, month, day] = testDate.split('-').map(Number);
            const utcDate = new Date(Date.UTC(year, month - 1, day, 5, 0, 0, 0));
            
            console.log('üß™ Test for 2025-09-24:');
            console.log('Input:', testDate);
            console.log('UTC Date:', utcDate.toISOString());
            console.log('EST Display:', utcDate.toLocaleDateString('en-US', { timeZone: 'America/New_York' }));
            console.log('Date object:', utcDate);
            
            alert('Check console for date conversion debug info!');
        };
        
        console.log('‚úÖ All functions loaded!');
    </script>
</body>
</html>
